<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' https://www.youtube.com https://s.ytimg.com https://sdk.scdn.co 'unsafe-inline'; media-src * blob:;">
    
    <title>Twilight</title>

    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Jersey+10&family=Sixtyfour+Convergence&display=swap" rel="stylesheet">
    <script src="https://sdk.scdn.co/spotify-player.js" defer></script>
</head>
<body>

    <h1 id="title">Twilight</h1>

    <audio id="midnaAppears" src="./sound_effects/midna_appears.mp3"></audio>
    <audio id="wolfTransform" src="./sound_effects/wolf_transform.wav"></audio>
    <audio id="humanTransform" src="./sound_effects/human_transform.wav"></audio>
    <audio id="midnaVanish" src="./sound_effects/midna_vanish.mp3"></audio>

    <div id="borderbox"></div>

    <div id="frame">
        <button id="reset-button">Reset</button>
        <button id="exit-button">X</button>
    </div>



    <!-- User -->
    <div id="player" style="display:none"></div>

    <!-- image box -->
    <div id="imagebox"></div>

    <!-- buttons in start screen -->
    <button id="menu">Menu</button>
    <button id="queue">Queue List</button>

    <!-- queue display -->
    <div id="songlist-container" class="hidden">
        <p id="upcoming-song">Upcoming Song:</p>
        <p id="play-next"></p>
        <p id="song-history">Songs Played Recently:</p>
        <p id="past-songs"></p>
    </div>


    <button id="savedSongs">Saved Songs</button>

    <div id="savedSongs-container" class="hidden">
        <input type="text" id="addSongBar" placeholder="Add Song"></button>
        <div id="addSongSearch-results"></div>
        <div id="savedSongsList"></div>
        <button id="createPlaylistButton">Create Playlist</button>
        <button id="shuffleButton">Shuffle</button>
        <button id="playButton">Play</button>
    </div>

    <!-- menu buttons -->
    <button id="switchApi" class="hidden" onClick='playTransformSound()'>Switch to Spotify</button>
    <button id="back" class="hidden">Back</button>

    <!-- search container -->
    <div class="search-container">
        <input type="text" id="searchbar" placeholder="Search for song">
        <div id="search-results" class="hidden"></div>
    </div>

    <div id="now-playing">
        <p id="song-title" class="hidden">No song playing</p>
    </div>


    <!-- progress bar container-->
    <div id="progress-container">
        <div id="progress-bar">
            <div id="progress-current"></div>
        </div>
        
        <div id="time-display">
            <span id="current-time">0:00</span>
            <span id="duration">0:00</span>
        </div>
    </div>

    <div id="volume-container">

        <button id="volume-up" class="volume-button">ðŸ”Š</button>
        <br>
        <button id="volume-down" class="volume-button">ðŸ”‰</button>
    </div>


    <!-- audio button displays -->
    <div id="buttonbox">
        <div id="controls">
            <button id="prev-button" class="control-button">â—€â—€</button>
            <button id="pause-button" class="control-button">â–¶</button>
            <button id="next-button" class="control-button">â–¶â–¶</button>
        </div>
    </div>

    <p id="apiDisplay"></p>

    <script src="sound_effects.js"></script>
    
    <script>
        // Load YouTube API after fully loading page first
        window.addEventListener('load', function() {
            if (!window.YT) {
                const tag = document.createElement('script');
                tag.src = "https://www.youtube.com/iframe_api";
                const firstScriptTag = document.getElementsByTagName('script')[0];
                firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
            }
        });
    </script>

    <script src="saved_songs.js"></script>
    <script src="spotify.js"></script>
    <script src="youtube.js"></script>
    
</body>
</html>